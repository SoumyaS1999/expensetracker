<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Expense Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
</head>
<body>
    <form id="form" onsubmit="addlocal(event)">
        <label for ="expense">Choose expense amount :</label>
        <input type="number" id="expense" name="expense" title="expense" autocomplete="off">

        <label for ="desc">Choose description :</label>
        <input type="text" id="desc" name="'desc" autocomplete="off">
        <label for ="category">Choose a category :</label>
        <select class="category" id ="category" name="category" autocomplete="off">
            <option>Fuel</option>
            <option>Food</option>
            <option>Electricity</option>
            <option>Movie</option>
        <input type="submit" id="btn" value="submit" >
    </form>
    <ul class ="ul" id="item-list"></ul>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.5.1/axios.min.js" ></script>

    <script>
    function addlocal(event){ 
        event.preventDefault();

        const expense =event.target.expense.value;
        const desc=event.target.desc.value;
        const category=event.target.category.value;


        const obj ={
            expense,
            desc,
            category
        }
        axios.post("http://localhost:3000/expense/add-expense",obj)
        .then((response)=>{
            display(response.data.newExpenseDetail)
            console.log(response)
        })
        .catch((err)=>{
            console.log(err)
        })

        }
        window.addEventListener("DOMContentLoaded",()=>{
            axios.get("http://localhost:3000/expense/get-expense")
            .then((response)=>{
                console.log(response)
                for (var i=0; i<response.data.allExpenses.length;i++){
                    display(response.data.allExpenses[i])
                }
            })
            .catch((error)=> {
                console.log(error)
            })
        })
    function display(obj){


        if (localStorage.getItem(obj.desc) !== null){
            removeUserfromscreen(obj.desc)
        }

        const parentElem= document.getElementById('item-list');
        const childElem = `<li id=${obj.id}>Rs ${obj.expense} - ${obj.desc} - ${obj.category}
                            <button onclick=deleteUser('${obj.id}')>Delete</button>
                            <button onclick=editUser('${obj.expense}','${obj.desc}','${obj.category}','${obj.id}')>Edit</button>
                            </li>`
        parentElem.innerHTML= parentElem.innerHTML+childElem ;
        }

        //delete button
        function deleteUser(userId){
            axios.delete(`http://localhost:3000/expense/delete-expense/${userId}`)
            .then((response)=>{
                removeUserfromscreen(userId)
            })
            .catch((err)=>{
                console.log(err)
            })
    
        }

        //edit button
        function editUser(expense,desc,category,userId){
            document.getElementById('expense').value= expense;
            document.getElementsById('desc').value= desc;
            document.getElementById('category').value=category;

            deleteUser(userId);

            
        }

        //remove user from screen
        function removeUserfromscreen(userId){
            const parentElem= document.getElementById('item-list');
            const childElemtobedeleted = document.getElementById(userId);
            if(childElemtobedeleted){
                parentElem.removeChild(childElemtobedeleted);
            }


        }
    </script>
    
</body>
</html>